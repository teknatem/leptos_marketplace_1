# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ç–∞ a015_wb_orders (Wildberries Orders)

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –∞–≥—Ä–µ–≥–∞—Ç **a015_wb_orders** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –∏–∑ Wildberries API.

**API Endpoint:** `GET /api/v1/supplier/orders`

## üöÄ –ß—Ç–æ –±—ã–ª–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### ‚úÖ 1. Contracts (Domain Models)
- `crates/contracts/src/domain/a015_wb_orders/aggregate.rs` - –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–≥—Ä–µ–≥–∞—Ç–∞
- `crates/contracts/src/domain/a015_wb_orders/mod.rs` - —ç–∫—Å–ø–æ—Ä—Ç —Ç–∏–ø–æ–≤
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ `crates/contracts/src/domain/mod.rs`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:**
- `WbOrders` - –æ—Å–Ω–æ–≤–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ç
- `WbOrdersHeader` - –∑–∞–≥–æ–ª–æ–≤–æ–∫ (connection_id, organization_id, marketplace_id)
- `WbOrdersLine` - —Å—Ç—Ä–æ–∫–∞ –∑–∞–∫–∞–∑–∞ (–∞—Ä—Ç–∏–∫—É–ª, –±–∞—Ä–∫–æ–¥, —Ü–µ–Ω—ã, –±—Ä–µ–Ω–¥, –∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏ —Ç.–¥.)
- `WbOrdersState` - —Å—Ç–∞—Ç—É—Å—ã (order_dt, is_cancel, cancel_dt, —Ñ–ª–∞–≥–∏)
- `WbOrdersWarehouse` - —Å–∫–ª–∞–¥
- `WbOrdersGeography` - –≥–µ–æ–≥—Ä–∞—Ñ–∏—è (—Å—Ç—Ä–∞–Ω–∞, —Ä–µ–≥–∏–æ–Ω, –æ–±–ª–∞—Å—Ç—å)
- `WbOrdersSourceMeta` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (income_id, sticker, g_number, raw_payload_ref)

### ‚úÖ 2. Backend Domain Layer
- `crates/backend/src/domain/a015_wb_orders/repository.rs` - —Ä–∞–±–æ—Ç–∞ —Å –ë–î (SeaORM)
- `crates/backend/src/domain/a015_wb_orders/service.rs` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
  - –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ marketplace_product_ref
  - –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ nomenclature_ref
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å raw JSON
- `crates/backend/src/domain/a015_wb_orders/mod.rs` - —ç–∫—Å–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ `crates/backend/src/domain/mod.rs`

### ‚úÖ 3. Backend Handlers (REST API)
- `crates/backend/src/handlers/a015_wb_orders.rs`
  - `GET /api/a015/wb-orders` - —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
  - `GET /api/a015/wb-orders/:id` - –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
  - `GET /api/a015/wb-orders/search-by-srid` - –ø–æ–∏—Å–∫ –ø–æ SRID
  - `GET /api/a015/raw/:ref_id` - –ø–æ–ª—É—á–µ–Ω–∏–µ raw JSON –∏–∑ WB API
  - `POST /api/a015/wb-orders/:id/delete` - —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ `crates/backend/src/handlers/mod.rs`
- –†–æ—É—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ `crates/backend/src/main.rs`

### ‚úÖ 4. WB API Client
–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ `crates/backend/src/usecases/u504_import_from_wildberries/wildberries_api_client.rs`:
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ `WbOrderRow` - –º–∞–ø–ø–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ API
- –ú–µ—Ç–æ–¥ `fetch_orders()` - –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ (flag=0 –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, flag=1 —Å–ª–µ–¥—É—é—â–∏–µ)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `wildberries_api_requests.log`

### ‚úÖ 5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ u504 Executor
`crates/backend/src/usecases/u504_import_from_wildberries/executor.rs`:
- –î–æ–±–∞–≤–ª–µ–Ω case `"a015_wb_orders"` –≤ `run_import()`
- –°–æ–∑–¥–∞–Ω –º–µ—Ç–æ–¥ `import_wb_orders()` - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `import_wb_sales()`

**–õ–æ–≥–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:**
1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ WB API
2. –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç (order_dt, last_change_dt, cancel_dt)
3. –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ WbOrders
4. –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ marketplace_product –∏ nomenclature
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å raw JSON

### ‚úÖ 6. Frontend UI
**List –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** (`crates/frontend/src/domain/a015_wb_orders/ui/list/mod.rs`):
- –¢–∞–±–ª–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- –§–∏–ª—å—Ç—Ä—ã: –¥–∞—Ç–∞ —Å/–ø–æ, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
- –ü–æ–∏—Å–∫ –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É, –Ω–æ–º–µ—Ä—É –∑–∞–∫–∞–∑–∞, –±—Ä–µ–Ω–¥—É
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–ª—è–º
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è (50 –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É)
- –í—ã–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –∫—Ä–∞—Å–Ω—ã–º —Ü–≤–µ—Ç–æ–º

**Details –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** (`crates/frontend/src/domain/a015_wb_orders/ui/details/mod.rs`):
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ
- –ö–∞—Ä—Ç–æ—á–∫–∏: –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, —Ç–æ–≤–∞—Ä, —Å–∫–ª–∞–¥ –∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏—è
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å Raw JSON" - –ø—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ WB API

–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ `crates/frontend/src/domain/mod.rs`

### ‚úÖ 7. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**–§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:** `migrate_a015_wb_orders.sql`

**–¢–∞–±–ª–∏—Ü–∞:** `a015_wb_orders`

**–ü–æ–ª—è:**
- `id` (TEXT PRIMARY KEY) - UUID –¥–æ–∫—É–º–µ–Ω—Ç–∞
- `code`, `description`, `comment` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è
- `document_no` (TEXT NOT NULL) - SRID –∏–∑ WB (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `header_json`, `line_json`, `state_json` - JSON —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- `warehouse_json`, `geography_json`, `source_meta_json` - –¥–æ–ø. –¥–∞–Ω–Ω—ã–µ
- `marketplace_product_ref`, `nomenclature_ref` - —Å—Å—ã–ª–∫–∏
- `is_deleted`, `is_posted` - —Ñ–ª–∞–≥–∏
- `created_at`, `updated_at`, `version` - audit –ø–æ–ª—è

**–ò–Ω–¥–µ–∫—Å—ã:**
- UNIQUE –Ω–∞ `document_no` (SRID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª–µ–Ω)
- –Ω–∞ `is_deleted`, `created_at`, `is_posted`
- –Ω–∞ `marketplace_product_ref`, `nomenclature_ref`

## üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### 1. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
# Windows
sqlite3 target\db\marketplace.db < migrate_a015_wb_orders.sql

# Linux/Mac
sqlite3 target/db/marketplace.db < migrate_a015_wb_orders.sql
```

### 2. –ó–∞–ø—É—Å–∫ –∏–º–ø–æ—Ä—Ç–∞
–í UI –∏–º–ø–æ—Ä—Ç–∞ –∏–∑ Wildberries (u504):
1. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WB
2. –£–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ (–¥–∞—Ç–∞ —Å/–ø–æ)
3. –û—Ç–º–µ—Ç—å—Ç–µ —á–µ–∫–±–æ–∫—Å **"a015_wb_orders"**
4. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç"

### 3. –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"Wildberries –ó–∞–∫–∞–∑—ã"** –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π –∏–∑ WB API
```json
{
  "date": "order_dt",
  "lastChangeDate": "last_change_dt", 
  "supplierArticle": "supplier_article",
  "nmId": "nm_id",
  "barcode": "barcode",
  "isCancel": "is_cancel",
  "cancelDate": "cancel_dt",
  "finishedPrice": "finished_price",
  "srid": "document_no"
}
```

### –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫
1. **marketplace_product_ref**: –∏—â–µ—Ç—Å—è –ø–æ `connection_id` + `supplier_article`
   - –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. **nomenclature_ref**: –±–µ—Ä–µ—Ç—Å—è –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ/—Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ `marketplace_product`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã:
- RFC3339: `2022-03-04T18:08:31Z`
- ISO 8601: `2022-03-04T18:08:31`

### –°—Ç–∞—Ç—É—Å –æ—Ç–º–µ–Ω—ã
- `is_cancel = true` ‚Üí –∑–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω
- `cancel_dt` ‚Üí –¥–∞—Ç–∞ –æ—Ç–º–µ–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –í UI –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –≤—ã–¥–µ–ª–µ–Ω—ã –∫—Ä–∞—Å–Ω—ã–º —Ñ–æ–Ω–æ–º

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å a012_wb_sales

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | a012_wb_sales | a015_wb_orders |
|----------------|---------------|-----------------|
| API endpoint | `/api/v1/supplier/sales` | `/api/v1/supplier/orders` |
| –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID | SRID | SRID |
| –ì–µ–æ–≥—Ä–∞—Ñ–∏—è | ‚ùå | ‚úÖ (country, region, oblast) |
| –û—Ç–º–µ–Ω–∞ | ‚ùå | ‚úÖ (is_cancel, cancel_dt) |
| –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ | ‚úÖ (posting) | ‚ö†Ô∏è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| –¶–µ–Ω—ã | sale-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ | order-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ |

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å**: –∫–∞–∂–¥—ã–π SRID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –≤ –ë–î
2. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è API**: WB –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º 100,000 –∑–∞–ø–∏—Å–µ–π –∑–∞ –∑–∞–ø—Ä–æ—Å
3. **Raw JSON**: —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `document_raw_storage` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
4. **is_posted**: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `true`, –Ω–æ –ø—Ä–æ–µ–∫—Ü–∏–∏ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. –î–æ–±–∞–≤–∏—Ç—å posting –º–æ–¥—É–ª—å (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –ø—Ä–æ–µ–∫—Ü–∏–∏)
2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ü–∏—é p904_wb_orders_register (–∞–Ω–∞–ª–æ–≥ p900)
3. –î–æ–±–∞–≤–∏—Ç—å batch –æ–ø–µ—Ä–∞—Ü–∏–∏ (batch_delete –∏ —Ç.–¥.)
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ Excel

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [ ] –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –ë–î
- [ ] Backend –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Frontend –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] API endpoints –æ—Ç–≤–µ—á–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ò–º–ø–æ—Ä—Ç –∏–∑ WB API —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] UI —Å–ø–∏—Å–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–∫–∞–∑—ã
- [ ] UI –¥–µ—Ç–∞–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- [ ] Raw JSON –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] –§–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –û—Ç–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –≤—ã–¥–µ–ª–µ–Ω—ã –∫—Ä–∞—Å–Ω—ã–º

---

**–î–∞—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 2025-11-18  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–ê–≤—Ç–æ—Ä:** AI Assistant (Claude Sonnet 4.5)

