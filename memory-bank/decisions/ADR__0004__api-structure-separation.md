---
type: decision-record
number: "0004"
date: 2026-01-11
status: accepted
tags: [architecture, api, backend, handlers]
---

# ADR-0004: Разделение API на бизнес и системный модули

## Контекст

В проекте была единая структура для всех HTTP handlers:
- `handlers/` — содержал 30+ файлов (бизнес + системные)
- `routes.rs` — один файл ~640 строк
- `system/handlers/` — только auth и users

Проблемы:
1. Нет чёткого разделения между бизнес и системной логикой
2. Сложно навигировать по большому handlers/
3. Несимметричная структура

## Решение

Разделить API на два модуля с симметричной структурой:

```
api/
├── mod.rs
├── routes.rs              # configure_business_routes()
└── handlers/              # Бизнес handlers

system/api/
├── mod.rs
├── routes.rs              # configure_system_routes()
└── handlers/              # Системные handlers
```

## Альтернативы

### 1. Оставить как есть
- ✅ Нет работы
- ❌ Проблемы останутся

### 2. Только переименовать handlers → api
- ✅ Меньше изменений
- ❌ Не решает проблему смешения бизнес/системного

### 3. Вынести handlers в отдельный crate
- ✅ Максимальное разделение
- ❌ Избыточная сложность для текущего размера проекта

### 4. Выбранный: Симметричная структура api/ и system/api/
- ✅ Чёткое разделение ответственности
- ✅ Консистентная структура
- ✅ Лёгко масштабируется
- ❌ Требует рефакторинга

## Последствия

### Положительные
- Чёткое разделение бизнес и системной логики
- Симметричная, предсказуемая структура
- Отдельные функции конфигурации routes для гибкости

### Отрицательные
- Необходимость обновить все импорты `crate::handlers::`
- Обнаружены архитектурные проблемы (domain → handlers)

## Реализация

- [x] Создать `api/` модуль
- [x] Создать `system/api/` модуль
- [x] Переместить handlers
- [x] Разделить routes
- [x] Обновить main.rs
- [x] Удалить старые файлы
- [x] Проверить компиляцию
