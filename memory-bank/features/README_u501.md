# UseCase u501: –ò–º–ø–æ—Ä—Ç –∏–∑ –£–¢ 11 - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ backend

```bash
cargo run --bin backend
```

Backend –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3000`

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ 1–° –£–¢ 11

**–ß–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```bash
curl -X POST http://localhost:3000/api/connection_1c/testdata
```

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:**
```bash
curl -X POST http://localhost:3000/api/connection_1c \
  -H "Content-Type: application/json" \
  -d '{
    "description": "–£–¢ 11 Production",
    "url": "http://your-1c-server/ut11/odata/standard.odata",
    "login": "admin",
    "password": "password",
    "isPrimary": true
  }'
```

### 3. –ü–æ–ª—É—á–∏—Ç—å ID –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
curl http://localhost:3000/api/connection_1c
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `id` –∏–∑ –æ—Ç–≤–µ—Ç–∞.

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–º–ø–æ—Ä—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

```bash
curl -X POST http://localhost:3000/api/u501/import/start \
  -H "Content-Type: application/json" \
  -d '{
    "connection_id": "–≤–∞—à-uuid-–∑–¥–µ—Å—å",
    "target_aggregates": ["a002_organization"]
  }'
```

–û—Ç–≤–µ—Ç:
```json
{
  "session_id": "session-uuid",
  "status": "started",
  "message": "–ò–º–ø–æ—Ä—Ç –∑–∞–ø—É—â–µ–Ω"
}
```

### 5. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ SESSION_ID –Ω–∞ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π session_id
curl http://localhost:3000/api/u501/import/SESSION_ID/progress
```

–ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ –∑–∞–ø—Ä–æ—Å –∫–∞–∂–¥—ã–µ 2-3 —Å–µ–∫—É–Ω–¥—ã –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–∞.

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```bash
curl http://localhost:3000/api/organization
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

```json
{
  "session_id": "uuid",
  "status": "running",  // running | completed | completed_with_errors | failed
  "started_at": "2025-01-15T10:00:00Z",
  "completed_at": null,
  "aggregates": [
    {
      "aggregate_index": "a002_organization",
      "aggregate_name": "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏",
      "status": "running",  // pending | running | completed | failed
      "processed": 150,
      "total": 200,
      "inserted": 50,
      "updated": 100,
      "errors": 0,
      "current_item": null
    }
  ],
  "total_processed": 150,
  "total_inserted": 50,
  "total_updated": 100,
  "total_errors": 0,
  "errors": []
}
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã

–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏–º–ø–æ—Ä—Ç:
- ‚úÖ `a002_organization` - –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–∑ `Catalog_–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏`

–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:
- üöß `a003_product` - –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞
- üöß `a004_counterparty` - –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ 1–° –£–¢ 11

1. **–í–µ—Ä—Å–∏—è**: 1–°:–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤–ª–µ–π 11.5+
2. **OData**: –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω OData –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
3. **–î–æ—Å—Ç—É–ø**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤
4. **URL**: –§–æ—Ä–º–∞—Ç `http://server:port/–±–∞–∑–∞/odata/standard.odata`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ OData

```bash
curl http://your-1c-server/ut11/odata/standard.odata/Catalog_–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ \
  -u admin:password
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```json
{
  "status": "failed",
  "errors": [
    {
      "message": "OData request failed with status 401",
      "occurred_at": "2025-01-15T10:05:00Z"
    }
  ]
}
```

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL, –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏.

### –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```json
{
  "status": "completed_with_errors",
  "total_errors": 5,
  "errors": [
    {
      "aggregate_index": "a002_organization",
      "message": "Failed to process organization ORG-001",
      "details": "–ò–ù–ù –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä",
      "occurred_at": "2025-01-15T10:10:00Z"
    }
  ]
}
```

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ 1–°, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∏–º–ø–æ—Ä—Ç.

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–°–∫–æ—Ä–æ—Å—Ç—å**: ~100-500 –∑–∞–ø–∏—Å–µ–π/–º–∏–Ω (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞ 1–°)
- **Batch size**: 100 –∑–∞–ø–∏—Å–µ–π –∑–∞ –∑–∞–ø—Ä–æ—Å
- **Timeout**: 30 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∫–∞–∂–¥—ã–π HTTP-–∑–∞–ø—Ä–æ—Å

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

Backend –≤—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å:

```
INFO Starting import for session: uuid
INFO Fetching OData from: http://server/ut11/odata/standard.odata/Catalog_–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏?$top=100&$skip=0
INFO Organizations import completed: processed=200, inserted=50, updated=150
INFO Import completed for session: uuid
```

–î–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `RUST_LOG=debug`:

```bash
RUST_LOG=debug cargo run --bin backend
```

## –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### Q: –ö–∞–∫ –æ—Ç–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç?

A: –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –æ—Ç–º–µ–Ω–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞. –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –ø–æ –æ—à–∏–±–∫–µ.

### Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?

A: –î–∞, –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –∏—Ö –≤ `target_aggregates`:
```json
{
  "target_aggregates": ["a002_organization", "a003_product"]
}
```

### Q: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∏–º–ø–æ—Ä—Ç–µ?

A: –°–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç **upsert**: –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ. –£–¥–∞–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç.

### Q: –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–æ–Ω–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç?

A: –§–æ–Ω–æ–≤—ã–π —Ä–µ–∂–∏–º –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –±—É–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏. –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `mode: "interactive"`.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–º. –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö:
- [naming-conventions.md](memory-bank/naming-conventions.md) - –°–æ–≥–ª–∞—à–µ–Ω–∏—è –æ–± –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏
- [usecase-u501-import-from-ut.md](memory-bank/usecase-u501-import-from-ut.md) - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–≥—Ä–µ–≥–∞—Ç–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ `from_ut_odata.rs` –≤ `backend/src/domain/aXXX_your_aggregate/`
2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ OData –º–æ–¥–µ–ª—å –∏ –º–∞–ø–ø–∏–Ω–≥
3. –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥ –∏–º–ø–æ—Ä—Ç–∞ –≤ `executor.rs`
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ match statement

–ü—Ä–∏–º–µ—Ä —Å–º. –≤ [a002_organization/from_ut_odata.rs](crates/backend/src/domain/a002_organization/from_ut_odata.rs)

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ 1–° –¥–æ—Å—Ç—É–ø–Ω–∞ –∏ OData —Ä–∞–±–æ—Ç–∞–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ 1–°

## –õ–∏—Ü–µ–Ω–∑–∏—è

–ß–∞—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ Leptos Marketplace.
