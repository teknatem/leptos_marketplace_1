---
date: 2026-01-11
type: runbook
version: 1
tags: [frontend, refactoring, leptos]
---

# Runbook: Frontend Module Refactoring

## When to Use

- Переименование/перемещение модулей во frontend
- Удаление дублирующегося кода
- Реструктуризация каталогов

## Pre-flight Checks

### 1. Найти все использования модуля

```bash
# Поиск импортов
rg "use crate::module_name" crates/frontend/src

# Поиск re-exports
rg "pub use.*module_name" crates/frontend/src
```

### 2. Проверить, есть ли мёртвый код

Если импортов 0 — модуль можно удалить без последствий.

### 3. Сравнить дублирующийся код

При наличии похожих файлов — проверить различия (разные match arms, дополнительные функции).

## Execution Steps

### Step 1: Создать новые модули

Создать файлы в целевой структуре, скопировав/объединив код.

### Step 2: Обновить mod.rs / lib.rs

```rust
// lib.rs
pub mod new_module;  // добавить
// pub mod old_module; // закомментировать (пока не удаляем)
```

### Step 3: Обновить импорты в зависимых файлах

```rust
// Было
use crate::old_module::Component;

// Стало
use crate::new_module::Component;
```

### Step 4: Проверить компиляцию

```bash
cargo check -p frontend
```

### Step 5: Удалить старые файлы

Только после успешной компиляции!

### Step 6: Финальная проверка

```bash
cargo check -p frontend
```

## Rollback

Если что-то пошло не так:

1. `git checkout -- crates/frontend/src/` — откатить изменения
2. Удалить новые файлы вручную

## Common Pitfalls

| Проблема                     | Решение                               |
| ---------------------------- | ------------------------------------- |
| Забыли обновить mod.rs       | Компилятор покажет "module not found" |
| Разные tab keys в дубликатах | Объединить ВСЕ ключи в новый registry |
| Удалили используемый код     | Проверять grep перед удалением        |

## Checklist

- [ ] Найдены все импорты старого модуля
- [ ] Проверен мёртвый код
- [ ] Созданы новые модули
- [ ] Обновлены mod.rs / lib.rs
- [ ] Обновлены импорты
- [ ] Компиляция успешна
- [ ] Старые файлы удалены
- [ ] Финальная компиляция успешна
