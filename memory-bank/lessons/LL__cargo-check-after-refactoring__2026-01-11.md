---
date: 2026-01-11
type: lesson-learned
topic: cargo check after refactoring
tags:
  - rust
  - refactoring
  - tooling
---

# Lesson Learned: Использование cargo check после рефакторинга

## Контекст

При массовом переименовании модулей/каталогов в Rust проекте, grep/ripgrep может не найти все места для обновления, особенно если файлы находятся внутри переименованных каталогов.

## Урок

**`cargo check --workspace`** - лучший инструмент для поиска всех мест, требующих обновления после переименования модулей.

## Почему grep недостаточен

1. Grep ищет по содержимому файлов, но не понимает семантику Rust импортов
2. После переименования каталога, grep может показывать "No matches found", хотя внутри файлов всё ещё есть старые пути
3. Кэширование или timing issues могут давать неполные результаты

## Рекомендуемый подход

```powershell
# 1. Переименовать каталоги и mod.rs

# 2. Запустить проверку
cargo check --workspace 2>&1 | Select-String "error"

# 3. Исправить каждую ошибку

# 4. Повторить до успеха
```

## Типы ошибок компиляции при переименовании

```
error[E0433]: failed to resolve: could not find `old_name` in `parent`
error[E0432]: unresolved import `crate::parent::old_name`
```

Оба указывают на файлы, где нужно обновить пути импортов.

## Паттерн итеративного исправления

```
cargo check → ошибка в file.rs → исправить → cargo check → следующая ошибка → ...
```

Этот цикл гарантирует, что ни одна ссылка не будет пропущена.
