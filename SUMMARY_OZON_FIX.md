# –°–≤–æ–¥–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ü–∏–π p904 –¥–ª—è OZON

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–µ–∫—Ü–∏–∏ p904 –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ OZON:
- ‚úÖ **OZON FBS Posting** (a010) - –ø—Ä–æ–¥–∞–∂–∏ FBS
- ‚úÖ **OZON FBO Posting** (a011) - –ø—Ä–æ–¥–∞–∂–∏ FBO
- ‚úÖ **OZON Returns** (a009) - –≤–æ–∑–≤—Ä–∞—Ç—ã

### 2. –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (5 —Ñ–∞–π–ª–æ–≤):
1. `crates/backend/src/projections/p904_sales_data/projection_builder.rs`
2. `crates/backend/src/projections/p904_sales_data/service.rs`
3. `crates/backend/src/domain/a010_ozon_fbs_posting/posting.rs`
4. `crates/backend/src/domain/a011_ozon_fbo_posting/posting.rs`
5. `crates/backend/src/domain/a009_ozon_returns/posting.rs`

### 3. Backend —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω –≤ release —Ä–µ–∂–∏–º–µ ‚úÖ

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### OZON –¥–æ–∫—É–º–µ–Ω—Ç—ã –≤ –ë–î:
- **FBS**: 968 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ø—Ä–æ–≤–µ–¥–µ–Ω—ã, –Ω–æ –±–µ–∑ p904)
- **FBO**: 299 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ù–ï –ø—Ä–æ–≤–µ–¥–µ–Ω—ã)
- **Returns**: 141 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ø—Ä–æ–≤–µ–¥–µ–Ω—ã, –Ω–æ –±–µ–∑ p904)

### –î–∞–Ω–Ω—ã–µ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ö –∑–∞ 2025-12:
- **p900_sales_register**: ‚úÖ OZON –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å (1042 –∑–∞–ø–∏—Å–µ–π)
- **p904_sales_data**: ‚ùå OZON –¥–∞–Ω–Ω—ã—Ö –ù–ï–¢ (–Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ)

## üöÄ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–π backend
```powershell
cd e:\dev\rust\2\leptos_marketplace_1
.\target\release\backend.exe
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã OZON

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ß–µ—Ä–µ–∑ SQL
```bash
sqlite3 "E:/dev/rust/leptos_marketplace_1/data/app.db" < repost_ozon_documents.sql
```
–≠—Ç–æ –æ—Ç–º–µ–Ω–∏—Ç –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –≤—Å–µ—Ö FBO –∏ Returns –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ SQL –Ω–∞–ø—Ä—è–º—É—é
```sql
-- –û—Ç–º–µ–Ω–∏—Ç—å –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ
UPDATE a011_ozon_fbo_posting SET is_posted = 0;
UPDATE a009_ozon_returns SET is_posted = 0;
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ UI
–ü–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è, –∑–∞–π—Ç–∏ –≤ UI –∏ –ø—Ä–æ–≤–µ—Å—Ç–∏:
1. –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã a011_ozon_fbo_posting (299 —à—Ç.)
2. –í—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã a009_ozon_returns (141 —à—Ç.)

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: FBS –¥–æ–∫—É–º–µ–Ω—Ç—ã (968 —à—Ç.) —É–∂–µ –ø—Ä–æ–≤–µ–¥–µ–Ω—ã, –Ω–æ –∏—Ö —Ç–æ–∂–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è p904 –ø—Ä–æ–µ–∫—Ü–∏–π.

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ p904_sales_data –∑–∞ –¥–µ–∫–∞–±—Ä—å 2025
SELECT 
    registrator_type, 
    COUNT(*) as cnt,
    SUM(customer_in) as revenue_in,
    SUM(customer_out) as revenue_out
FROM p904_sales_data 
WHERE date LIKE '2025-12%'
GROUP BY registrator_type
ORDER BY registrator_type;
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
WB_Sales         | 5436 | 59.5M  | 0
YM_Order         | 1133 | 15.2M  | 0
YM_Returns       | 34   | 0      | -0.3M
OZON_FBS         | ~900 | ~20M   | 0      ‚Üê –ù–û–í–û–ï!
OZON_FBO         | ~300 | ~7M    | 0      ‚Üê –ù–û–í–û–ï!
OZON_Returns     | ~141 | 0      | -1.5M  ‚Üê –ù–û–í–û–ï!
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞—à–±–æ—Ä–¥ d400_monthly_summary
–û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥ –∑–∞ 2025-12 –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ OZON –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è! üéâ

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–æ–µ–∫—Ü–∏–∏ p904 –¥–ª—è OZON:

**OZON FBS** (—Ç–æ–ª—å–∫–æ DELIVERED):
- –î–∞—Ç–∞: `delivered_at` –∏–ª–∏ `updated_at_source`
- –í—ã—Ä—É—á–∫–∞: `customer_in = amount_line`
- –°–æ–∑–¥–∞—ë—Ç—Å—è `marketplace_product_ref` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**OZON FBO** (–≤—Å–µ —Å—Ç–∞—Ç—É—Å—ã):
- –î–∞—Ç–∞: `delivered_at` –∏–ª–∏ `updated_at_source` –∏–ª–∏ `created_at`
- –í—ã—Ä—É—á–∫–∞: `customer_in = amount_line`
- –°–æ–∑–¥–∞—ë—Ç—Å—è `marketplace_product_ref` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

**OZON Returns** (–≤—Å–µ –≤–æ–∑–≤—Ä–∞—Ç—ã):
- –î–∞—Ç–∞: `return_date`
- –í–æ–∑–≤—Ä–∞—Ç: `customer_out = -(price √ó quantity)`
- –°–æ–∑–¥–∞—ë—Ç—Å—è `marketplace_product_ref` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –¥–∞—à–±–æ—Ä–¥ **d400_monthly_summary** –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ OZON –∑–∞ –ª—é–±–æ–π –ø–µ—Ä–∏–æ–¥!
